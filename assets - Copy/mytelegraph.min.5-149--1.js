(self["tmg.build"]=self["tmg.build"]||[]).push([[927,625,802,164,2,768,378,816,661],{181:(t,e,s)=>{t.exports=function t(e,s,r){function i(o,a){if(!s[o]){if(!e[o]){if(n)return n(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=s[o]={exports:{}};e[o][0].call(l.exports,(function(t){return i(e[o][1][t]||t)}),l,l.exports,t,e,s,r)}return s[o].exports}for(var n=void 0,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,e,s){"use strict";var r=t("../src/store-engine"),i=[t("../storages/localStorage"),t("../storages/sessionStorage"),t("../storages/cookieStorage"),t("../storages/memoryStorage")];e.exports=r.createStore(i,[])},{"../src/store-engine":2,"../storages/cookieStorage":4,"../storages/localStorage":5,"../storages/memoryStorage":6,"../storages/sessionStorage":7}],2:[function(t,e,s){"use strict";function r(t,e,s){s||(s=""),t&&!u(t)&&(t=[t]),e&&!u(e)&&(e=[e]);var r=s?"__storejs_"+s+"_":"",i=s?new RegExp("^"+r):null;if(!/^[a-zA-Z0-9_\-]*$/.test(s))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var d={_namespacePrefix:r,_namespaceRegexp:i,_testStorage:function(t){try{var e="__storejs__test__";t.write(e,e);var s=t.read(e)===e;return t.remove(e),s}catch(t){return!1}},_assignPluginFnProp:function(t,e){var s=this[e];this[e]=function(){function e(){if(s)return a(arguments,(function(t,e){r[e]=t})),s.apply(i,r)}var r=n(arguments,0),i=this,o=[e].concat(r);return t.apply(i,o)}},_serialize:function(t){return JSON.stringify(t)},_deserialize:function(t,e){if(!t)return e;var s="";try{s=JSON.parse(t)}catch(e){s=t}return void 0!==s?s:e},_addStorage:function(t){this.enabled||this._testStorage(t)&&(this.storage=t,this.enabled=!0)},_addPlugin:function(t){var e=this;if(u(t))a(t,(function(t){e._addPlugin(t)}));else{var s=o(this.plugins,(function(e){return t===e}));if(!s){if(this.plugins.push(t),!p(t))throw new Error("Plugins must be function values that return objects");var r=t.call(this);if(!g(r))throw new Error("Plugins must return an object of function properties");a(r,(function(s,r){if(!p(s))throw new Error("Bad plugin property: "+r+" from plugin "+t.name+". Plugins should only return functions.");e._assignPluginFnProp(s,r)}))}}},addStorage:function(t){(function(){var t="undefined"==typeof console?null:console;t&&(t.warn?t.warn:t.log).apply(t,arguments)})("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(t)}},m=l(d,h,{plugins:[]});return m.raw={},a(m,(function(t,e){p(t)&&(m.raw[e]=c(m,t))})),a(t,(function(t){m._addStorage(t)})),a(e,(function(t){m._addPlugin(t)})),m}var i=t("./util"),n=i.slice,o=i.pluck,a=i.each,c=i.bind,l=i.create,u=i.isList,p=i.isFunction,g=i.isObject;e.exports={createStore:r};var h={version:"2.0.12",enabled:!1,get:function(t,e){var s=this.storage.read(this._namespacePrefix+t);return this._deserialize(s,e)},set:function(t,e){return void 0===e?this.remove(t):(this.storage.write(this._namespacePrefix+t,this._serialize(e)),e)},remove:function(t){this.storage.remove(this._namespacePrefix+t)},each:function(t){var e=this;this.storage.each((function(s,r){t.call(e,e._deserialize(s),(r||"").replace(e._namespaceRegexp,""))}))},clearAll:function(){this.storage.clearAll()},hasNamespace:function(t){return this._namespacePrefix=="__storejs_"+t+"_"},createStore:function(){return r.apply(this,arguments)},addPlugin:function(t){this._addPlugin(t)},namespace:function(t){return r(this.storage,this.plugins,t)}}},{"./util":3}],3:[function(t,e,r){(function(t){"use strict";function s(t,e){return Array.prototype.slice.call(t,e||0)}function r(t,e){i(t,(function(t,s){return e(t,s),!1}))}function i(t,e){if(n(t)){for(var s=0;s<t.length;s++)if(e(t[s],s))return t[s]}else for(var r in t)if(t.hasOwnProperty(r)&&e(t[r],r))return t[r]}function n(t){return null!=t&&"function"!=typeof t&&"number"==typeof t.length}var o=Object.assign?Object.assign:function(t,e,s,i){for(var n=1;n<arguments.length;n++)r(Object(arguments[n]),(function(e,s){t[s]=e}));return t},a=function(){if(Object.create)return function(t,e,r,i){var n=s(arguments,1);return o.apply(this,[Object.create(t)].concat(n))};var t=function(){};return function(e,r,i,n){var a=s(arguments,1);return t.prototype=e,o.apply(this,[new t].concat(a))}}(),c=String.prototype.trim?function(t){return String.prototype.trim.call(t)}:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},l="undefined"!=typeof window?window:t;e.exports={assign:o,create:a,trim:c,bind:function(t,e){return function(){return e.apply(t,Array.prototype.slice.call(arguments,0))}},slice:s,each:r,map:function(t,e){var s=n(t)?[]:{};return i(t,(function(t,r){return s[r]=e(t,r),!1})),s},pluck:i,isList:n,isFunction:function(t){return t&&"[object Function]"==={}.toString.call(t)},isObject:function(t){return t&&"[object Object]"==={}.toString.call(t)},Global:l}}).call(this,void 0!==s.g?s.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(t,e,s){"use strict";function r(t){for(var e=l.cookie.split(/; ?/g),s=e.length-1;s>=0;s--)if(c(e[s])){var r=e[s].split("="),i=unescape(r[0]);t(unescape(r[1]),i)}}function i(t){t&&n(t)&&(l.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function n(t){return new RegExp("(?:^|;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(l.cookie)}var o=t("../src/util"),a=o.Global,c=o.trim;e.exports={name:"cookieStorage",read:function(t){if(!t||!n(t))return null;var e="(?:^|.*;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(l.cookie.replace(new RegExp(e),"$1"))},write:function(t,e){t&&(l.cookie=escape(t)+"="+escape(e)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")},each:r,remove:i,clearAll:function(){r((function(t,e){i(e)}))}};var l=a.document},{"../src/util":3}],5:[function(t,e,s){"use strict";function r(){return n.localStorage}function i(t){return r().getItem(t)}var n=t("../src/util").Global;e.exports={name:"localStorage",read:i,write:function(t,e){return r().setItem(t,e)},each:function(t){for(var e=r().length-1;e>=0;e--){var s=r().key(e);t(i(s),s)}},remove:function(t){return r().removeItem(t)},clearAll:function(){return r().clear()}}},{"../src/util":3}],6:[function(t,e,s){"use strict";e.exports={name:"memoryStorage",read:function(t){return r[t]},write:function(t,e){r[t]=e},each:function(t){for(var e in r)r.hasOwnProperty(e)&&t(r[e],e)},remove:function(t){delete r[t]},clearAll:function(t){r={}}};var r={}},{}],7:[function(t,e,s){"use strict";function r(){return n.sessionStorage}function i(t){return r().getItem(t)}var n=t("../src/util").Global;e.exports={name:"sessionStorage",read:i,write:function(t,e){return r().setItem(t,e)},each:function(t){for(var e=r().length-1;e>=0;e--){var s=r().key(e);t(i(s),s)}},remove:function(t){return r().removeItem(t)},clearAll:function(){return r().clear()}}},{"../src/util":3}]},{},[1])(1)},969:(t,e,s)=>{"use strict";s.d(e,{Z:()=>n});var r=s(384);class i{constructor(t,e){this.tooltipMainClass="js-tooltip-main",this.tooltipCloseClass="js-tooltip-close",this.tooltipArrowClass="js-tooltip-arrow",this.tooltipShowClass="overlay-tooltip--is-visible",this.tooltipOffset=5,this.target=t,this.settings=e,this.buildTooltip()}buildTooltip(){this.createWrapper(),this.createMarkup(),this.bindEvents()}createWrapper(){const t=document.createElement("div");t.className="overlay-tooltip__wrapper",this.settings.wrapperStyle&&t.setAttribute("style",this.settings.wrapperStyle),t.style.position="relative",t.style.overflow="visible",this.wrapElement(this.target,t),this.tooltipWrapper=this.target.parentNode}createMarkup(){const{buttons:t}=this.settings||!1,e=document.createElement("div");e.className=`overlay-tooltip overlay-tooltip--${this.settings.positionY}-${this.settings.positionX} ${this.tooltipMainClass}`;let s=`<button class="overlay-tooltip__close ${this.tooltipCloseClass}"></button>\n\t\t\t\t\t\t<span class="overlay-tooltip__arrow ${this.tooltipArrowClass}"></span>\n\t\t\t\t\t\t<div class="overlay-tooltip__content">${this.settings.content}</div>`;t&&(s+='<div class="overlay-tooltip__btn-wrapper">',t.forEach((t=>{s+=`<a href="${t.url}" class="overlay-tooltip__button ${t.alternate?"overlay-tooltip__button--alternate":""}">${t.label}</a>`})),s+="</div>"),e.innerHTML=s,this.tooltipWrapper.append(e),this.tooltip=this.tooltipWrapper.querySelector(`.${this.tooltipMainClass}`),this.closeTooltip=this.tooltipWrapper.querySelector(`.${this.tooltipCloseClass}`),this.arrowTooltip=this.tooltipWrapper.querySelector(`.${this.tooltipArrowClass}`),this.arrowWidth=parseInt(window.getComputedStyle(this.arrowTooltip).getPropertyValue("border-bottom-width"),10)}getTooltipPosition(t){let e=0,s=0,r=t;for(;t;)e+=t.offsetLeft-t.scrollLeft+t.clientLeft,t=t.offsetParent;return s=window.innerWidth-(e+r.offsetWidth),{l:e,r:s}}setTooltipPosition(){const t=`${this.target.offsetHeight+this.arrowWidth+this.tooltipOffset}px`;"top"===this.settings.positionY&&(this.tooltip.style.bottom=t),"bottom"===this.settings.positionY&&(this.tooltip.style.top=t)}repositioningTooltip(){let t=this.getTooltipPosition(this.tooltip);t.l<0&&"right"===this.settings.positionX&&(this.tooltip.style.right=`${parseInt(window.getComputedStyle(this.tooltip).getPropertyValue("right"),10)+t.l}px`,this.arrowTooltip.style.right=parseInt(window.getComputedStyle(this.arrowTooltip).getPropertyValue("right"),10)-t.l+"px"),t.r<0&&"left"===this.settings.positionX&&(this.tooltip.style.left=`${parseInt(window.getComputedStyle(this.tooltip).getPropertyValue("left"),10)+t.r}px`,this.arrowTooltip.style.left=parseInt(window.getComputedStyle(this.arrowTooltip).getPropertyValue("left"),10)-t.r+"px")}resetPositioningTooltip(){this.tooltip.style.right="",this.tooltip.style.left="",this.setTooltipArrow()}setTooltipArrow(){const t=this.target.offsetWidth/2;"left"===this.settings.positionX&&(this.arrowTooltip.style.left=t-this.arrowWidth+"px"),"right"===this.settings.positionX&&(this.arrowTooltip.style.right=t-this.arrowWidth/2+"px")}wrapElement(t,e){t.parentNode.insertBefore(e,t),e.appendChild(t)}bindEvents(){this.closeTooltip.addEventListener("click",(()=>{this.hideTooltip()})),["orientationchange","resize"].forEach((t=>{window.addEventListener(t,(()=>{this.resetPositioningTooltip(),this.repositioningTooltip()}))}))}revealTooltip(){this.setTooltipPosition(),this.setTooltipArrow(),this.tooltip.classList.add(this.tooltipShowClass),this.repositioningTooltip()}hideTooltip(){this.tooltip.classList.remove(this.tooltipShowClass),this.resetPositioningTooltip()}}r.Z.create("Tooltip"),r.Z.create("tooltip"),tmg.tooltip=i;const n=i},410:(t,e,s)=>{"use strict";s.d(e,{Z:()=>a});var r=s(453),i=s(384),n=s(436);class o{constructor(){this.params={local:"local",qa:"qa",ci:"ci",staging:"staging",prod:"prod"},this.currentEnv=this.determineEnvironment(),i.Z.create("tmg.environment"),tmg.environment={currentEnv:this.currentEnv,getEnvironment:this.getEnvironment,getList:this.getList,getTld:this.getTld,isCommentingTurnedOn:this.isCommentingTurnedOn,isHttps:this.isHttps,isLocal:this.isLocal,isProd:this.isProd}}determineEnvironment(){const t=n.Z.getLocation().hostname.split(".");return t.some((t=>"local"===t||"127"===t||"localhost"===t))?this.getList().local:t.some((t=>/(^|-)ci[0-9]+(-app)?$/i.test(t)))?this.getList().ci:t.some((t=>/(^|-)qa[0-9]+(-app)?$/i.test(t)))?this.getList().qa:t.some((t=>/(^|-)staging(.*)$/i.test(t)))?this.getList().staging:this.getList().prod}getList(){return this.params}getEnvironment(){return this.currentEnv}getTld(){return"telegraph.co.uk"}isCommentingTurnedOn(){let t=!1;try{void 0!==tmg.COMMENTING_STATUS&&(t=!!tmg.COMMENTING_STATUS)}catch(t){console.log(t)}return t}isHttps(){return"https:"===n.Z.getLocation().protocol||this.isLocal()}isLocal(){return this.getEnvironment()===this.getList().local}isProd(){return this.getEnvironment()===this.getList().prod}}r.Z.subscribe({topic:"tmg.page.ready",func:new o,runIfAlreadyPublished:!0});const a=o},436:(t,e,s)=>{"use strict";s.d(e,{Z:()=>o});var r=s(384),i=s(453);class n{constructor(){r.Z.create("tmg.page"),tmg.page={getMetaTag:this.getMetaTag,getMetaContent:this.getMetaContent,getPageType:this.getPageType,getPageTitle:this.getPageTitle,getChannel:this.getChannel,getBusinessSegment:this.getBusinessSegment,getCategory:this.getCategory,getContentType:this.getContentType,getArticleId:this.getArticleId,getPublishDate:this.getPublishDate,getKeywords:this.getKeywords,getLocation:this.getLocation,getLeadAssetLayout:this.getLeadAssetLayout,isArticle:this.isArticle,isSponsored:this.isSponsored,isGallery:this.isGallery,isGallery2:this.isGallery2,isPremium:this.isPremium,isApp:this.isApp.bind(this)}}getPageType(){return window.dataLayer&&window.dataLayer.pageType}getPageTitle(){return document.title}getChannel(){return this.getMetaContent("tmgads.channel")}getCategory(){return this.getMetaContent("DCSext.Category")}getBusinessSegment(){return this.getMetaContent("tmgads.businessSegment")}getContentType(){return this.getMetaContent("DCSext.Content_Type")}getArticleId(){return this.getMetaContent("tmgads.articleid")}getPublishDate(){return this.getMetaContent("DCSext.articleFirstPublished")}getKeywords(){return this.getMetaContent("keywords").split(",").map((t=>t.trim()))}getLocation(){return document.location}getMetaContent(t,e="content"){const s=this.getMetaTag(t);let r="generic";return s&&s.getAttribute(e)&&(r=s.getAttribute(e)),r}getMetaTag(t){return document.querySelector(`meta[name='${t}']`)}isArticle(){let t=!1;return["articleRenderer","articleRenderer2","longFormRenderer"].forEach((e=>{this.getPageType()===e&&(t=!0)})),t}isGallery(){return"galleryRenderer"===this.getPageType()}isGallery2(){return"galleryRenderer2"===this.getPageType()}isSponsored(){return"sponsored"===this.getBusinessSegment()}isPremium(){return"true"===this.getMetaContent("tmg.premium.state")}isApp(){return"true"===this.getMetaContent("tmg.app")}isAuthor(){return document.documentElement.hasAttribute("data-is-author")}getLeadAssetLayout(){return this.isArticle()&&document.querySelector("[data-lead-asset-layout]")?document.querySelector("[data-lead-asset-layout]").dataset.leadAssetLayout:this.isArticle()?"hidden":void 0}}i.Z.subscribe({topic:"tmg.page.ready",func:new n,runIfAlreadyPublished:!0});const o=new n},453:(t,e,s)=>{"use strict";s.d(e,{Z:()=>n});var r=s(384);const i=new class{constructor(){this.topics=[],this.publishedTopics=[],this.UID=-1}subscribe({topic:t,func:e,runIfAlreadyPublished:s}){if("function"!=typeof e)return!1;if(s)for(let s=0;s<this.publishedTopics.length;s++)this.publishedTopics[s]===t&&e.call();const r=(this.UID+=1).toString();return this.topics.push({token:r,topic:t,func:e}),r}unsubscribe({topic:t}){for(let e=0;e<this.topics.length;e++)this.topics[e].topic===t&&this.topics.splice(e,1)}publish({topic:t}){this.publishedTopics.push(t);for(let e=0;e<this.topics.length;e++)this.topics[e].topic===t&&this.topics[e].func.call()}};r.Z.create("tmg.pubsub"),window.tmg.pubsub=i;const n=i},987:(t,e,s)=>{"use strict";s.d(e,{Z:()=>O});var r=s(42),i=s(978),n=s(384),o=s(470),a=s(436),c=s(453);const l={pId:"",firstName:"",lastName:"",username:"",email:"",readerType:"",subscriber:"",subButton:"",subscriptionType:"",subscriptionName:""},u={viafouraRefresh:"VfRefresh",pianoRefToken:"user_ref_token",pianoIDToken:"__utp",meterCount:"tmg_meter_count",personalisation:"tmg_p13n",publicId:"tmg_pid",registrationSuccess:"tmg_registration_success",rememberMe:"tmg_rem",session:"tmg_session",refreshToken:"tmg_refresh",subscriptionConfirmation:"tmg_subscription_confirmation"},p="ACCESS_TOKEN",g="validAppUser",h="tmg.user.mytelegraph.token",d="tmg.user.mytelegraph.onboarded.status",m=document.querySelector("html");let f={};const v=(t,e)=>{if(e||(()=>{let t=document.querySelectorAll('[class*="logged-in--"], [class*="is-subscriber--"], [class*="app-tmg-subscriber--"]');t=Array.prototype.slice.call(t),t.forEach((t=>{v(t,!0)}))})(),t)return t.className=t.className.replace(new RegExp("\\b(?:logged-in--|is-subscriber--|app-tmg-subscriber--).+\\b","g"),""),t.classList&&(t.classList.add(`logged-in--${b()}`),t.classList.add(`is-subscriber--${w()}`),t.classList.add(`app-tmg-subscriber--${S()}`)),t.classList},y=()=>{let t=r.Z.get(u.personalisation);return i.Z.tryParse(t,l)},b=()=>!!r.Z.get(u.session),w=()=>"true"===f.subscriber,T=()=>!!localStorage.getItem(p),A=()=>localStorage.getItem(g)||"{}",S=()=>{try{const t=A(),e=T(),s="TMG"===JSON.parse(t).subscriptionType;return e&&s}catch(t){return!1}},_=()=>{try{const t=A(),e=T(),s="All Digital Access"===JSON.parse(t).subscriptionName;return e&&s}catch(t){return!1}},E=()=>(window.sessionStorage.removeItem("id_token"),window.sessionStorage.removeItem("access_token"),window.localStorage.removeItem(g),window.localStorage.removeItem(p),void 0!==window.vf&&window.vf.session.logout(),r.Z.remove(u.viafouraRefresh),r.Z.remove(u.session),C(),!0),C=()=>(f=y(),v(m),f),P={applyStatusCssClasses:v,clearAllData:()=>{E();for(let t in u)r.Z.remove(u[t]);o.Z.remove("fyre-auth"),o.Z.remove("fyre-authentication-creds"),C()},getPianoRefToken:()=>r.Z.get(u.pianoRefToken)||!1,getPianoIDToken:()=>r.Z.get(u.pianoIDToken)||!1,getMeterCount:()=>!1,getMyTelegraphToken:()=>{const t=o.Z.storage.read(h);return"undefined"!==t&&null!==t&&t},getProfile:y,getSubscriberId:()=>JSON.parse(localStorage.getItem("pid"))||"",getAccessToken:()=>localStorage.getItem(p)||"",getPublicId:()=>r.Z.get(u.publicId)||"",getSessionId:()=>r.Z.get(u.session)||"",getRefreshToken:()=>r.Z.get(u.refreshToken)||"",isLoggedIn:b,isLoggedInApp:()=>!!localStorage.getItem(g),isRegistered:()=>!!f.pId,isSubscriber:w,isAdLite:()=>!0===_()||"true"===a.Z.getMetaContent("tmg.isAdLite"),isGoogleShowcase:()=>"true"===a.Z.getMetaContent("tmg.isGoogleShowcase"),canComment:()=>b()&&w(),canCommentInApp:()=>S(),isAppTmgSubscriber:S,isAppTmgDigitalPlusSubscriber:_,isMyTelegraphOnboarded:()=>!!o.Z.storage.read(d),login:()=>(C(),!1),logout:E,setMyTelegraphToken:({token:t})=>o.Z.storage.write(h,t),setMyTelegraphOnboarded:({status:t})=>o.Z.storage.write(d,t),updateState:C};n.Z.create("tmg.user"),window.tmg.user=P,f=C(),c.Z.publish({topic:"tmg.user.ready"});const O=P},774:(t,e,s)=>{"use strict";var r=s(904);var i=s(384),n=s(453),o=s(978),a=s(969),c=s(951),l=s(436);const u={save:!1,follow:!1},p="/secure/register/",g="/secure/login/",h=({product:t="mytelegraph",featureName:e="",url:s=p})=>{let r="",i=c.Z.setQuerystringParam(s,"redirectTo",l.Z.getLocation().href);const n=window.TMG_COMPONENT_TRACKING;return e&&n&&n.isDtmEnabled()&&(r=n.createIcid({product:t,contentLocation:e}),i=c.Z.setQuerystringParam(i,"ICID",r)),`${i}`};var d=s(987);const m={selectors:{saveArticle:"[data-save-article]",saveArticleText:"[data-js='save-article-text']",saveArticleMessage:"",saveArticleMessageLink:"",saveError:".error--save-article"},classes:{savedArticle:"save-article--saved"},analyticsEvents:{save:"articleSave",unsave:"articleRemove",messageClick:""}},f={save:"",saveArticleText:""},v=class{constructor(t,e,s,r=f,i=m){this.saveHandler=t,this.errorView=e,this.analytics=s,this.elements=Object.assign({},f,r),this.settings=Object.assign({},{selectors:Object.assign({},m.selectors,i.selectors||{})},{classes:Object.assign({},m.classes,i.classes||{})},{analyticsEvents:Object.assign({},m.analyticsEvents,i.analyticsEvents||{})}),this.tooltip=((t,e,s)=>{const r={wrapperStyle:!1,content:"This feature is available for registered users. Please register or log in to continue",positionY:"bottom",positionX:"left",buttons:[{label:"Register",url:h({featureName:s,url:p})},{label:"Log in",url:h({featureName:s,url:g}),alternate:!0}]};let i=document.querySelector(t);if(i){let t=Object.assign({},r,e);return new a.Z(i,t)}return u[s]})(this.settings.selectors.saveArticle,{positionX:"right"},"save"),this.contentType=l.Z.getContentType()}build(){const{id:t}=this.getArticleSaveInfo();return this.saveHandler.checkArticleSavedState({id:t}).then((t=>{this.cacheArticleElements(),t&&this.updateArticleSaveState({saved:!0}),this.bindEvents()}))}cacheArticleElements(){const{selectors:t}=this.settings,{elements:e}=this;e.save=document.querySelector(t.saveArticle),e.saveArticleText=document.querySelector(t.saveArticleText),t.saveArticleMessageLink.length>0&&(e.messageLink=document.querySelector(t.saveArticleMessageLink))}getArticleSaveInfo(){const t=this.settings.selectors.saveArticle;return this.articleSaveInfo||(this.articleSaveInfo=this._parseDataAttributeOptions(t)),this.articleSaveInfo}updateArticleSaveState({saved:t=!1}){const{classes:e}=this.settings,{text:s}=this.getArticleSaveInfo(),{elements:r}=this;t?(r.save.classList.add(e.savedArticle),r.saveArticleText.textContent=s.saved):(r.save.classList.remove(e.savedArticle),r.saveArticleText.textContent=s.save)}updateArticleSaveMessage({saved:t=!1}){const{saveArticleMessage:e}=this.settings.selectors;e&&(t?r.Z.turnOn(e):r.Z.turnOff(e))}_parseDataAttributeOptions(t){const{settings:e}=this;let s,r=t.match(/\[(.*?)\]/i,"")[1],i=document.querySelector(t);if(i.getAttribute){const t=i.getAttribute(r);s=o.Z.tryParse(t,e.save)}return s}bindEvents(){const{selectors:t,classes:e,analyticsEvents:s}=this.settings,{saveHandler:r,errorView:i,tooltip:n,analytics:o,contentType:a}=this,{save:c,messageLink:l}=this.elements,{id:u}=this.getArticleSaveInfo();c&&c.addEventListener("click",(()=>{if(d.Z.isLoggedIn())return c.classList.contains(e.savedArticle)?r.unsaveArticle({id:u}).then((t=>{o.recordEvent({event:[s.unsave],contentType:a}),this.updateArticleSaveState({saved:!1}),this.updateArticleSaveMessage({saved:!1})}),(e=>{i.show(t.saveError)})):r.saveArticle({id:u}).then((()=>{o.recordEvent({event:[s.save],contentType:a}),this.updateArticleSaveState({saved:!0}),this.updateArticleSaveMessage({saved:!0})}),(e=>{i.show(t.saveError)}));r.storeArticle(u),n.revealTooltip()})),l&&l.addEventListener("click",(t=>{t.preventDefault();const e=l.getAttribute("href");o.recordEvent({event:[s.messageClick]}),setTimeout((function(){window.location=e}),500)}))}turnOn(){return r.Z.turnOn(this.settings.selectors.saveArticle),this}turnOff(){r.Z.turnOff(this.settings.selectors.saveArticle)}};var y=s(410);const b={active:!1,api:{domain:"telegraph.co.uk",subDomain:{prod:"api-prod",preprod:"api-preprod"},ignoreEnvironment:!1,basePath:"/mytelegraph/",paths:{auth:"auth/web",feed:"feed/v0.3.0/user",preferences:{base:"preferences/v0.5.0/user",follow:"/follows",save:"/articles"}}}},w=class{constructor(t=b){this.settings=t,this.env=new y.Z,this.currentEnv=this.env.getEnvironment(),this.endpoints=this.setEndpoints()}setEndpoints(){const{api:t}=this.settings,{paths:e}=t,{preferences:s}=e,r=d.Z.getProfile().pId,i=this.getApiBaseUri(this.currentEnv),n=`${i}${e.auth}?response_type=token&client_id=HyOLHxhzrHME0oTZIpZ9JlVWCZRrAIzq`,o=`${i}${s.base}/${r}`;return{pid:r,base:i,auth:n,user:o,follow:`${o}${s.follow}`,save:`${o}${s.save}`}}getApiBaseUri(t){const{api:e}=this.settings;return e.ignoreEnvironment||"prod"===t?`https://${e.subDomain.prod}.${e.domain}${e.basePath}`:`https://${e.subDomain.preprod}.${e.domain}${e.basePath}`}authenticate({forceValidate:t}={forceValidate:!1}){const e=d.Z.isLoggedIn(),s=d.Z.getRefreshToken();if(!e&&!s)return Promise.reject(new Error("No user session id"));const r={method:"POST",headers:{"X-Refresh-Token":s}};let i=d.Z.getMyTelegraphToken();return i&&!t?Promise.resolve(i):window.fetch(this.endpoints.auth,r).then(this.xhrStatus).then(this.jsonify).then((t=>(d.Z.setMyTelegraphToken({token:t.access_token}),t.access_token||{})),(t=>t))}callEndpoint({url:t,method:e,body:s}){return new Promise(((r,i)=>{this.authenticate().then((n=>{let o={headers:{authorization:`Bearer ${n}`}};return e&&s&&(o.method=e,o.body=JSON.stringify(s)),window.fetch(t,o).then(this.xhrStatus).then(this.jsonify).then((t=>{r(t)})).catch((t=>{i(t)}))})).catch((t=>{i(t)}))}))}xhrStatus(t){return t.status>=200&&t.status<300?Promise.resolve(t):401!==t.status?Promise.reject(new Error(t.statusText)):void 0}jsonify(t){return t.text().then((t=>t?o.Z.tryParse(t):{}))}};var T=s(470);const A=class extends w{storeArticle(t){let e=this._getStoredArticles();e&&!e.includes(t)&&e.push(t);const s={articles:e};return T.Z.storage.write("saveArticle",JSON.stringify(s))}updateStoredArticle(t){let e,s=this._getStoredArticles();s.includes(t)&&this.saveArticle({id:t}),e=s.filter((e=>e!==t));const r={articles:e};return T.Z.storage.write("saveArticle",JSON.stringify(r))}_getStoredArticles(){const t=T.Z.storage.read("saveArticle");return t?o.Z.tryParse(t).articles:[]}saveArticle({id:t}){let e=[t];return this.callEndpoint({url:this.endpoints.save,body:e,method:"PUT"})}unsaveArticle({id:t}){let e=[t];return this.callEndpoint({url:this.endpoints.save,body:e,method:"DELETE"})}checkArticleSavedState({id:t}){if(t)return this._getSavedArticles().then(((e=[])=>!("function"!=typeof e.includes||!e.includes(t))))}_getSavedArticles(){return this.callEndpoint({url:this.endpoints.save,method:"GET"}).then(((t=[])=>t),(t=>t))}},S={trackingData:{event:[],author:"",topic:"",contentType:""}};i.Z.create("tmg.mytelegraph");const _={active:!1},E=({active:t}=_)=>{if(!t)return void(tmg.mytelegraph={init:E});const e=new A,s=new class{show(t){r.Z.turnOn(t)}hide(t){r.Z.turnOff(t)}},i=new class{constructor({trackingData:t}=S){this.trackingData=t}_cleanupTrackingEventData(){const{trackingData:t}=this;Object.keys(t).forEach((t=>{delete window.dataLayer[t]}))}recordEvent(t=this.trackingData){t.event.length<1||(this._cleanupTrackingEventData(),Object.assign(window.dataLayer,t))}};tmg.mytelegraph={turnOnSave:()=>new v(e,s,i).turnOn().build(),turnOnSaveHotelReview:(t="")=>new v(e,s,i,{save:"",saveArticleText:""},{selectors:{saveArticle:`${t} [data-save-hotel-review]`,saveArticleText:`${t} [data-js='save-hotel-review-text']`,saveArticleMessage:`${t} .save-hotel-review__message`,saveArticleMessageLink:`${t} .save-hotel-review__message-link`,saveError:""},classes:{savedArticle:"save-hotel-review__button--saved"},analyticsEvents:{messageClick:"clicked_HR_save_confirmation"}}).turnOn().build()}};n.Z.subscribe({topic:"tmg.page.ready",func:E,runIfAlreadyPublished:!0})},42:(t,e,s)=>{"use strict";function r(){for(var t=0,e={};t<arguments.length;t++){var s=arguments[t];for(var r in s)e[r]=s[r]}return e}s.d(e,{Z:()=>i});const i=function t(e){function s(t,i,n){var o;if(arguments.length>1){if("number"==typeof(n=r({path:"/"},s.defaults,n)).expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*n.expires),n.expires=a}try{o=JSON.stringify(i),/^[\{\[]/.test(o)&&(i=o)}catch(t){}return i=(i=encodeURIComponent(String(i))).replace(/%(20|23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(20|23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[t,"=",i,n.expires&&"; expires="+n.expires.toUTCString(),n.path&&"; path="+n.path,n.domain&&"; domain="+n.domain,n.secure?"; secure":""].join("")}t||(o={});for(var c=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,u=0;u<c.length;u++){var p=c[u].split("="),g=p[0].replace(l,decodeURIComponent),h=p.slice(1).join("=");'"'===h.charAt(0)&&(h=h.slice(1,-1));try{if(h=e&&e(h,g)||h.replace(l,decodeURIComponent),this.json)try{h=JSON.parse(h)}catch(t){}if(t===g){o=h;break}t||(o[g]=h)}catch(t){}}return o}return s.get=s.set=s,s.getJSON=function(){return s.apply({json:!0},[].slice.call(arguments))},s.defaults={},s.remove=function(t,e){s(t,"",r(e,{expires:-1}))},s.withConverter=t,s}()},904:(t,e,s)=>{"use strict";s.d(e,{Z:()=>p});var r=s(384),i=s(453);const n={addAttributeToTurnOn:!1,addClassToTurnOn:!1,attributeName:"hidden",attributeValue:"",className:"",removeAttributeToTurnOn:!0,removeClassToTurnOn:!1,callbackFunction:!1},o=(t,e,s)=>{t.setAttribute(e,s)},a=(t,e)=>{t.classList.add(e)},c=(t,e)=>{t.removeAttribute(e)},l=(t,e)=>{t.classList.remove(e)};let u={addAttribute:o,addClass:a,removeAttribute:c,removeClass:l,turnOn:(t,{addAttributeToTurnOn:e,addClassToTurnOn:s,className:r,attributeName:i,attributeValue:u,removeAttributeToTurnOn:p,removeClassToTurnOn:g,callbackFunction:h}=n)=>{Array.from(document.querySelectorAll(t)).forEach((t=>{""!==i&&(e&&o(t,i,u),p&&c(t,i)),""!==r&&(s&&a(t,r),g&&l(t,r))})),h&&"function"==typeof h&&h()},turnOff:(t,{addAttributeToTurnOn:e,addClassToTurnOn:s,className:r,attributeName:i,attributeValue:u,removeAttributeToTurnOn:p,removeClassToTurnOn:g,callbackFunction:h}=n)=>{Array.from(document.querySelectorAll(t)).forEach((t=>{""!==i&&(e&&c(t,i),p&&o(t,i,u)),""!==r&&(s&&l(t,r),g&&a(t,r))})),h&&"function"==typeof h&&h()}};i.Z.subscribe({topic:"tmg.page.ready",func:()=>{r.Z.create("tmg.feature"),tmg.feature=u},runIfAlreadyPublished:!0});const p=u},978:(t,e,s)=>{"use strict";s.d(e,{Z:()=>p});var r=s(384);let i={};const n=t=>{let e={};return"string"==typeof t&&(e=o(t.replace(/'/g,'"'))),e},o=(t,e)=>{let s=e||{},r=t,i=!1,n="",o=[],p=[],g=[];const h=/[{?,\s]\s*"([^"]|\\")+"\s*:(\s*"([^"]|\\")+"|(.+))\s*[},]/gi,d=/^\s*{?\s*'|'\s*}?\s*$/i;if(!t)return s;if("[object Object]"===Object.prototype.toString.call(t))return t;if(i=c(r),i||(g=r.match(h)||[],g.forEach((t=>{if(t.includes('"label"')){const e=t.replace(/^\s*[{\s]|[,}]\s*$/gi,"").split(":")[1].replace(/\s*"([^]+|\\")"\s*$/gi,"$1"),s=e.replace(/"/gi,'\\"'),i=t.replace(e,s);r=r.replace(t,i)}})),n=r.replace(h,""),o=n.split(/,(?=(?:[^",]*:[^",]*)|[^",]*$)/)),o.forEach((t=>{const e=t.replace(/^\s*{|}\s*$/gi,"");c(a(e))||p.push(e)})),p.forEach((t=>{let e=!1,s=t;!0===d.test(t)&&(s=u(t),e=c(a(s))),e||!0!==/[^"']\w+[^"']:/.test(s)||(s=l(s),e=c(a(s))),e&&(r=r.replace(t,s))})),i=c(r),i)s=c(r);else try{JSON.parse(r)}catch(t){console.log("tmg.json.tryParse failed:",t)}return s},a=t=>`{${t}}`,c=t=>{let e=!1;try{e=JSON.parse(t)}catch(t){}return e},l=t=>{let e=t;return e=e.replace(/^\s*(.*?):/,'"$1":'),e},u=t=>{let e=t;return e=e.replace(/^\s*'([^']+|\\')':/,'"$1":'),e=e.replace(/:\s*('')\s*$/,': ""'),e=e.replace(/:\s*'([^']+|\\')'\s*$/,': "$1"'),e};i={parseFromAem:n,tryParse:o,simpleTryParse:c},r.Z.create("tmg.json"),tmg.json=i;const p=i;tmg.parseAemJson=n},384:(t,e,s)=>{"use strict";s.d(e,{Z:()=>i}),window.tmg=window.tmg||{};const r=function(t){try{let e=tmg,s=t.split(".");return"tmg"===s[0]&&(s=s.slice(1)),s.forEach((t=>{void 0===e[t]&&(e[t]={}),e=e[t]})),e}catch(e){console.warn("couldn't create namespace:",t)}};window.tmg.createNamespace=r;const i={create:r}},951:(t,e,s)=>{"use strict";s.d(e,{Z:()=>p});var r=s(384),i=s(436);const n=new RegExp(/\?[^#]*|(?=#)|$/),o=(()=>{const t={};return e=>t[e]||(t[e]=new RegExp(`([?&;]${e}(?=[=&;#]|$))=?([^&;#]*)`))})(),a=(t,e)=>{const s=o(e).exec(t);return s&&decodeURIComponent(s[2])},c=(t,e,s)=>{let r,c,l;return void 0===t&&(t=i.Z.getLocation().search),null===a(t,e)?(r=`${e}=${encodeURIComponent(s)}`,c=n.exec(t)[0],l=t.replace(n,(c.length?c+"&":"?")+r)):l=t.replace(o(e),`$1=${encodeURIComponent(s)}`),l},l=(t,e)=>{let s=e;if(null!==a(e,t)){let r,i=e.split("?")[0],n=(-1!==e.indexOf("?")?e.split("?")[1]:"").split("&");for(let e=n.length-1;e>=0;e-=1)r=n[e].split("=")[0],r===t&&n.splice(e,1);return s=i+(n.length>0?"?":"")+n.join("&"),s}return s},u=(t,e)=>{const s="redirectTo";return null!==a(t,s)?c(t,s,e):t};r.Z.create("tmg.GET_PARAM"),tmg.getQuerystringParam=a,tmg.setQuerystringParam=c,tmg.removeQuerystringParam=l,tmg.updateRedirectParam=u,location.search.substr(1).split("&").forEach((t=>{const e=t.split("=");e.length>1?tmg.GET_PARAM[e[0]]=decodeURIComponent(e[1]):tmg.GET_PARAM[e[0]]=""}));const p={matchParam:o,matchQuerystring:n,getQuerystringParam:a,removeQuerystringParam:l,setQuerystringParam:c,updateRedirectParam:u}},470:(t,e,s)=>{"use strict";s.d(e,{Z:()=>n});var r=s(181),i=s.n(r);s(384).Z.create("tmg.store"),tmg.store=i();const n=i()}},t=>{t(t.s=774)}]);