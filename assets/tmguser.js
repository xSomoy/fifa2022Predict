/*! tmguser v1.0.0 prd Â© Telegraph Media Group Limited 2020-2022 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tmguser=t():e.tmguser=t()}(this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./src/index.js")}({"../node_modules/js-cookie/dist/js.cookie.js":function(e,t,r){e.exports=function(){"use strict";function e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}return function t(r,n){function o(t,o,i){if("undefined"!=typeof document){"number"==typeof(i=e({},n,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var a in i)i[a]&&(s+="; "+a,!0!==i[a]&&(s+="="+i[a].split(";")[0]));return document.cookie=t+"="+r.write(o,t)+s}}return Object.create({set:o,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],n={},o=0;o<t.length;o++){var i=t[o].split("="),s=i.slice(1).join("=");try{var a=decodeURIComponent(i[0]);if(n[a]=r.read(s,a),e===a)break}catch(e){}}return e?n[e]:n}},remove:function(t,r){o(t,"",e({},r,{expires:-1}))},withAttributes:function(r){return t(this.converter,e({},this.attributes,r))},withConverter:function(r){return t(e({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(r)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},"../src/services/tmguser.js":function(e,t,r){"use strict";r.r(t),r.d(t,"tmguser",(function(){return P}));var n=r("../src/utility/cookies/cookie.js");function o(e){this.message=e}o.prototype=new Error,o.prototype.name="InvalidCharacterError";var i="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new o("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,i=0,s=0,a="";n=t.charAt(s++);~n&&(r=i%4?64*r+n:n,i++%4)?a+=String.fromCharCode(255&r>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return a};function s(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(i(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return i(t)}}function a(e){this.message=e}a.prototype=new Error,a.prototype.name="InvalidTokenError";var c=function(e,t){if("string"!=typeof e)throw new a("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(s(e.split(".")[r]))}catch(e){throw new a("Invalid token specified: "+e.message)}},u=function(e){return c(e)};function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,(r=[{key:"setItem",value:function(e,t){if("string"!=typeof t)try{var r=JSON.stringify(t);window.sessionStorage.setItem(e,r)}catch(e){console.error(e)}else window.sessionStorage.setItem(e,t)}},{key:"getItem",value:function(e){var t=window.sessionStorage.getItem(e);try{return JSON.parse(t)}catch(e){return t}}},{key:"removeItem",value:function(e){try{window.sessionStorage.removeItem(e)}catch(e){}}},{key:"clear",value:function(){window.sessionStorage.clear()}}])&&d(t.prototype,r),n&&d(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),l=new f;function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,o,i=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);s=!0);}catch(e){a=!0,o=e}finally{try{s||null==r.return||r.return()}finally{if(a)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return b(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var g={livefyreToken:"livefyre_token",idToken:"id_token",accessToken:"access_token",userRefToken:"user_ref_token"};function w(e){var t=!0;if(e){var r=Date.now(),n=u(e);(n&&n.iat?1e3*n.iat+6e5:r)>r&&(t=!1)}return t}function _(e){var t=e&&e.analytics||{productType:"",price:"",subscriptionType:"",tCode:"",acquisitionCompleted:!1,tmgId:"",offerCode:"",campaignCode:""};if(t){var r=JSON.stringify(t).replace(/"(\w+)"\s*:/g,"$1:"),o=new Date;o.setTime(o.getTime()+31536e6),Object(n.c)(n.a.tmgSubs,r)}}function v(e){window.fetch?(console.log("start swap"),window.fetch("https://api.telegraph.co.uk/userstore/cookies",{credentials:"include",mode:"cors",method:"POST",cache:"no-cache",headers:{"Content-Length":"0"}}).then((function(){console.log("done swap OK"),e&&e()})).catch((function(t){console.log("done swap NOK"),console.log(t),e&&e(),console.error(t)}))):e&&e()}function k(e,t){if(e){var r=e.profile,o="subscribed"===r.readerType||"subscriber"===r.readerType?"true":"false";r.subscriber=o,r.subButton=o;var i=function(e){var t=new Date;t.setTime(t.getTime()+94608e7);var r=Object.assign({},e);r.expire=t.getTime();var o=JSON.stringify(r).replace(/"(\w+)"\s*:/g,"$1:");Object(n.c)(n.a.tmg_p13n,o,t)};return i(r),new Promise((function(e,n){if(t){var o=r.pId,s="".concat("https://api.telegraph.co.uk").concat("/commerce","/accounts/").concat(o,"/status");window.fetch&&window.fetch(s,{mode:"cors",method:"GET",cache:"no-cache",headers:{id_token:t.id_token,access_token:t.access_token}}).then((function(e){return e.json()})).then((function(e){var t=e;t&&t.subscriptionType?(r.subscriptionType=t&&t.subscriptionType,i(r)):(r.allowWinback=t&&t.allowWinback,r.allowWinback&&i(r))})).then((function(){v((function(){return e(null)}))})).catch((function(t){v((function(){return e(null)})),console.error(t)}))}else v((function(){return e(null)}))}))}return Promise.resolve()}function O(){for(var e={},t=0,r=Object.entries(g);t<r.length;t++){var n=m(r[t],2),o=(n[0],n[1]),i=l.getItem(o);i&&(e[o]=i)}if((e=h(h({},e),e[g.userRefToken])).hasOwnProperty(g.accessToken)&&e.hasOwnProperty(g.idToken))return w(e.access_token)?null:e}function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=u(e.access_token),o=u(e.id_token),i=e.livefyre_token,s=e.refresh_token;t&&o&&o.profile&&(o.profile.readerType="subscriber");var a={tmg_evosession:{value:r.session.secureSessionKey,attributes:{expires:365,secure:!0,sameSite:"None"}},tmg_hasd_3:{value:r.permissions.find((function(e){return"comments"===e.name})).permissionTicket,attributes:{expires:365,secure:!0,sameSite:"None"}},tmg_pid:{value:r.profilePublicId,attributes:{expires:1095,secure:!0,sameSite:"None"}},tmg_session:{value:r.session.sessionKey,attributes:{expires:1095,secure:!0,sameSite:"None"}},livefyre_token:{value:i,attributes:{expires:1095,secure:!0,sameSite:"None"}},tmg_refresh:{value:s,attributes:{expires:1095,secure:!0,sameSite:"None"}},__utp:{value:e.piano_id_access_token,attributes:{expires:new Date(1e3*e.piano_id_access_token_expires_in),secure:!0,sameSite:"None"}},tmg_createddate:{value:o.profile.creationDateTimeInMillis,attributes:{expires:1095,secure:!0,sameSite:"None"}}};return n.b.add(n.a.tmgEvosession,a.tmg_evosession.value,a.tmg_evosession.attributes),n.b.add(n.a.tmgHashd3,a.tmg_hasd_3.value,a.tmg_hasd_3.attributes),n.b.add(n.a.tmgPid,a.tmg_pid.value,a.tmg_pid.attributes),n.b.add(n.a.tmgSession,a.tmg_session.value,a.tmg_session.attributes),n.b.add(n.a.tmg_createddate,a.tmg_createddate.value,a.tmg_createddate.attributes),e.piano_id_access_token&&n.b.add(n.a.__utp,a.__utp.value,a.__utp.attributes),window&&window.localStorage&&window.localStorage.setItem("_utprefreshdate",(new Date).toUTCString()),s&&n.b.add(n.a.tmgRefresh,a.tmg_refresh.value,a.tmg_refresh.attributes),i&&n.b.add(n.a.livefyreToken,a.livefyre_token.value,a.livefyre_token.attributes),i&&l.setItem(g.livefyreToken,i),l.setItem(g.idToken,e.id_token),l.setItem(g.accessToken,e.access_token),l.setItem(g.userRefToken,{user_ref_token:e.user_ref_token,user_ref_token_expires_in:e.user_ref_token_expires_in}),_(o),k(o,e)}function S(e){return new Promise((function(t,r){var n=l.getItem(g.accessToken),o=l.getItem(g.idToken);w(n)||w(o)?j(e).catch(r).then(t):t({id_token:o,access_token:n})}))}function j(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return S(t);var r=n.b.get(n.a.tmgRefresh);return new Promise((function(e,n){r?A("refresh_token",null,r,t).then((function(t){l.setItem(g.idToken,t.id_token),l.setItem(g.accessToken,t.access_token),e({id_token:t.id_token,access_token:t.access_token})})).catch((function(e){console.error(e),n(e)})):n(new Error("No tmg_refresh cookie"))}))}function A(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return new Promise((function(i,s){console.log("start login");var a={Accept:"application/json, text/plain, */*","Content-Type":"application/json",ddgFlow:window.ddgFlow||"transformation_login",ddgAction:"EMAIL_PASSWORD"},c=window&&window.location&&window.location.pathname;if(c){var d=c.split("/").filter((function(e){return e})).pop();d&&(a.ddgFlow="".concat(window.ddgFlow||"transformation","_").concat(d))}var f={grant_type:e,client_id:"tcuk",remember_me:!0};switch(e){case"refresh_token":f.refresh_token=r,a.ddgAction="refresh";break;case"password":f.identifier=t,f.auth_key=r,f.credential_type="EMAIL_PASSWORD";break;case"token":f.identifier=t,f.auth_key=r,f.credential_type="SOCIAL",a.ddgAction="social_"+t;break;default:f.grant_type="password",f.identifier=e,f.auth_key=t,f.credential_type="EMAIL_PASSWORD"}return window.fetch&&window.fetch("".concat("https://api.telegraph.co.uk").concat("/identity","/tokens"),{mode:"cors",method:"POST",cache:"no-cache",headers:a,body:JSON.stringify(f)}).then((function(e){return e.json()})).then((function(e){if(e.http_code>=400){var t={response:{data:h({},e),status:e.http_code}};s(t)}else if(o){var r=u(e.id_token).profile.email;if(r===o)T(e,n).then((function(t){console.log("end login"),i(e)}));else{var a=new Error("Emails don't match");a.email=r,s(a)}}else T(e,n).then((function(t){console.log("end login"),i(e)}))})).catch(s)}))}var P={login:A,logout:function(){return Object(n.c)(n.a.userRefToken,"",new Date(0)),Object(n.c)(n.a.ampAccess,"",new Date(0)),new Promise((function(e){Object.keys(n.a).forEach((function(e){e!==n.a.tmg_p13n&&n.b.remove(n.a[e])})),Object.keys(g).forEach((function(e){l.removeItem(g[e])})),e()}))},isLoggedIn:function(){return new Promise((function(e,t){O()?e(!0):j().then((function(){return e(!0)})).catch((function(){return e(!1)}))}))},refresh:j,register:function(e,t,r,n,o,i){return new Promise((function(s,a){var c={Accept:"application/json, text/plain, */*","Content-Type":"application/json",ddgFlow:window.ddgFlow||"transformation_register",ddgAction:"EMAIL_PASSWORD"},u={"@type":"Account",email:e,credentials:[{type:"EMAIL_PASSWORD",authKey:t}],remember_me:!0};return n&&(u.originator=n),o&&(u.channel=o),i&&(u.flexReg=i),r&&(u.preference={marketingEmailOptIn:!0}),window.fetch&&window.fetch("".concat("https://api.telegraph.co.uk").concat("/commerce","/accounts/lite"),{mode:"cors",method:"POST",cache:"no-cache",headers:c,body:JSON.stringify(u)}).then((function(e){return e.json()})).then((function(e){if(e.http_code>=400){var t={response:{data:h({},e),status:e.http_code}};a(t)}else T(e.accessToken).then((function(t){s(e)}))})).catch(a)}))},oauth:function(e,t,r,n,o){return new Promise((function(i,s){var a={Accept:"application/json, text/plain, */*","Content-Type":"application/json",ddgFlow:window.ddgFlow||"transformation_login",ddgAction:"EMAIL_PASSWORD"},c=window&&window.location&&window.location.pathname;if(c){var u=c.split("/").filter((function(e){return e})).pop();u&&(a.ddgFlow="".concat(window.ddgFlow||"transformation","_").concat(u))}var d={grant_type:e,client_id:"tcuk",remember_me:!0};switch(e){case"refresh_token":d.refresh_token=r,a.ddgAction="refresh";break;case"password":d.identifier=t,d.auth_key=r,d.credential_type="EMAIL_PASSWORD";break;case"token":d.identifier=t,d.auth_key=r,d.credential_type="SOCIAL",a.ddgAction="social_"+t;break;default:d.grant_type="password",d.identifier=e,d.auth_key=t,d.credential_type="EMAIL_PASSWORD"}var f="".concat("https://api.telegraph.co.uk").concat("/identity","/oauth/tokens?client_id=").concat(n,"&redirect_uri=").concat(o);return window.fetch&&window.fetch(f,{mode:"cors",method:"POST",cache:"no-cache",headers:a,body:JSON.stringify(d)}).then((function(e){return e.json()})).then((function(e){if(e.http_code>=400){var t={response:{data:h({},e),status:e.http_code}};s(t)}else i(e)})).catch(s)}))},__setAuthData:T,__userData:O}},"../src/services/userstatus.js":function(e,t,r){"use strict";r.r(t),r.d(t,"userstatus",(function(){return o}));var n=r("../src/utility/cookies/cookie.js");var o={isWinback:function(){var e=n.b.get(n.a.tmg_p13n);return!!e&&"true"===JSON.parse(e.replace(/(\w+)\s*:/g,'"$1":')).allowWinback},isSubscribed:function(){var e=n.b.get(n.a.tmg_p13n);if(e){var t=JSON.parse(e.replace(/(\w+)\s*:/g,'"$1":'));return"subscribed"===t.readerType||"subscriber"===t.readerType}return!1},isRegistered:function(){var e=n.b.get(n.a.tmg_p13n);return!!e&&"registered"===JSON.parse(e.replace(/(\w+)\s*:/g,'"$1":')).readerType}}},"../src/utility/cookies/cookie.js":function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"b",(function(){return c}));var n=r("../node_modules/js-cookie/dist/js.cookie.js"),o=r.n(n);function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s={livefyreToken:"livefyre-token",tmgEvosession:"tmg_evosession",tmgHashd3:"tmg_hashd_3",tmgPid:"tmg_pid",tmgSession:"tmg_session",tmgSubs:"tmg_subs",tmgRem:"tmg_rem",userRefToken:"user_ref_token",tmgRegistrationUpdate:"tmg_registration_update",tmgRefresh:"tmg_refresh",ampAccess:"amp-access",__utp:"__utp",tmg_p13n:"tmg_p13n",tmg_createddate:"tmg_createddate"};function a(e,t,r){e&&(document.cookie=e+"="+t+(r?";expires="+r.toUTCString():"")+";path=/;SameSite=None;Secure;domain=.telegraph.co.uk")}var c=new(function(){function e(){var t,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,r="get",n=o.a.get,r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,this.envDomain=".telegraph.co.uk"}var t,r,n;return t=e,(r=[{key:"add",value:function(e,t,r){!(r=r||{}).hasOwnProperty("domain")&&this.envDomain&&(r.domain=this.envDomain),o.a.set(e,t,r)}},{key:"remove",value:function(e){this.envDomain?o.a.remove(e,{domain:this.envDomain}):o.a.remove(e)}}])&&i(t.prototype,r),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}())},"./node_modules/whatwg-fetch/fetch.js":function(e,t,r){"use strict";r.r(t),r.d(t,"Headers",(function(){return h})),r.d(t,"Request",(function(){return v})),r.d(t,"Response",(function(){return O})),r.d(t,"DOMException",(function(){return S})),r.d(t,"fetch",(function(){return j}));var n="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==n&&n,o="URLSearchParams"in n,i="Symbol"in n&&"iterator"in Symbol,s="FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(e){return!1}}(),a="FormData"in n,c="ArrayBuffer"in n;if(c)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],d=ArrayBuffer.isView||function(e){return e&&u.indexOf(Object.prototype.toString.call(e))>-1};function f(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return i&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function y(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function m(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function b(e){var t=new FileReader,r=m(t);return t.readAsArrayBuffer(e),r}function g(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function w(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:s&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:a&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:o&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():c&&s&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=g(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c&&(ArrayBuffer.prototype.isPrototypeOf(e)||d(e))?this._bodyArrayBuffer=g(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):o&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s&&(this.blob=function(){var e=y(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=y(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(b)}),this.text=function(){var e,t,r,n=y(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=m(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a&&(this.formData=function(){return this.text().then(k)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(e,t){e=f(e),t=l(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},h.prototype.delete=function(e){delete this.map[f(e)]},h.prototype.get=function(e){return e=f(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(f(e))},h.prototype.set=function(e,t){this.map[f(e)]=l(t)},h.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},h.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),p(e)},h.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),p(e)},h.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),p(e)},i&&(h.prototype[Symbol.iterator]=h.prototype.entries);var _=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function v(e,t){if(!(this instanceof v))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,n,o=(t=t||{}).body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new h(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),_.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(o),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function k(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}})),t}function O(e,t){if(!(this instanceof O))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},w.call(v.prototype),w.call(O.prototype),O.prototype.clone=function(){return new O(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},O.error=function(){var e=new O(null,{status:0,statusText:""});return e.type="error",e};var T=[301,302,303,307,308];O.redirect=function(e,t){if(-1===T.indexOf(t))throw new RangeError("Invalid status code");return new O(null,{status:t,headers:{location:e}})};var S=n.DOMException;try{new S}catch(e){(S=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),S.prototype.constructor=S}function j(e,t){return new Promise((function(r,o){var i=new v(e,t);if(i.signal&&i.signal.aborted)return o(new S("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new h,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}})),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var o="response"in a?a.response:a.responseText;setTimeout((function(){r(new O(o,n))}),0)},a.onerror=function(){setTimeout((function(){o(new TypeError("Network request failed"))}),0)},a.ontimeout=function(){setTimeout((function(){o(new TypeError("Network request failed"))}),0)},a.onabort=function(){setTimeout((function(){o(new S("Aborted","AbortError"))}),0)},a.open(i.method,function(e){try{return""===e&&n.location.href?n.location.href:e}catch(t){return e}}(i.url),!0),"include"===i.credentials?a.withCredentials=!0:"omit"===i.credentials&&(a.withCredentials=!1),"responseType"in a&&(s?a.responseType="blob":c&&i.headers.get("Content-Type")&&-1!==i.headers.get("Content-Type").indexOf("application/octet-stream")&&(a.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof h?i.headers.forEach((function(e,t){a.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){a.setRequestHeader(e,l(t.headers[e]))})),i.signal&&(i.signal.addEventListener("abort",u),a.onreadystatechange=function(){4===a.readyState&&i.signal.removeEventListener("abort",u)}),a.send(void 0===i._bodyInit?null:i._bodyInit)}))}j.polyfill=!0,n.fetch||(n.fetch=j,n.Headers=h,n.Request=v,n.Response=O)},"./src/index.js":function(e,t,r){r("./node_modules/whatwg-fetch/fetch.js");var n=r("../src/services/tmguser.js").tmguser,o=r("../src/services/userstatus.js").userstatus,i={login:n.login,logout:n.logout,isLoggedIn:n.isLoggedIn,refresh:n.refresh,register:n.register,__userData:n.__userData,isWinback:o.isWinback,isSubscribed:o.isSubscribed,isRegistered:o.isRegistered,createSSOAccount:function(e,t,r,n){var o={"@type":"Account",email:e,lastName:r,firstName:t},i={Accept:"application/json, text/plain, */*","Content-Type":"application/json",ddgFlow:"transformation_onetap",ddgAction:"create_account_"+n};return window.fetch("".concat("https://api.telegraph.co.uk").concat("/commerce","/accounts/lite"),{mode:"cors",method:"POST",cache:"no-cache",headers:i,body:JSON.stringify(o)}).then((function(e){return e.json()}))},linkSSOAccount:function(e,t,r,n){var o={socialNetwork:t,accessToken:e},i={Accept:"application/json, text/plain, */*","Content-Type":"application/json",id_token:r,access_token:n,ddgFlow:"transformation_onetap",ddgAction:"link_account_"+t};return window.fetch&&window.fetch("".concat("https://api.telegraph.co.uk").concat("/commerce","/accounts/me/socialregistration"),{mode:"cors",method:"POST",cache:"no-cache",headers:i,body:JSON.stringify(o)}).then((function(e){return e.json()}))}};e.exports=i}})}));
//# sourceMappingURL=tmguser.js.map