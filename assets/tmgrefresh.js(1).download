/*! tmgrefresh v1.0.0 prd Â© Telegraph Media Group Limited 2020 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tmgrefresh=t():e.tmgrefresh=t()}(this,(function(){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s="./src/index.js")}({"../node_modules/jwt-decode/lib/atob.js":function(e,t){function o(e){this.message=e}o.prototype=new Error,o.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new o("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i=0,c=0,a="";r=t.charAt(c++);~r&&(n=i%4?64*n+r:r,i++%4)?a+=String.fromCharCode(255&n>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a}},"../node_modules/jwt-decode/lib/base64_url_decode.js":function(e,t,o){var n=o("../node_modules/jwt-decode/lib/atob.js");e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(n(e).replace(/(.)/g,(function(e,t){var o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o})))}(t)}catch(e){return n(t)}}},"../node_modules/jwt-decode/lib/index.js":function(e,t,o){"use strict";var n=o("../node_modules/jwt-decode/lib/base64_url_decode.js");function r(e){this.message=e}r.prototype=new Error,r.prototype.name="InvalidTokenError",e.exports=function(e,t){if("string"!=typeof e)throw new r("Invalid token specified");var o=!0===(t=t||{}).header?0:1;try{return JSON.parse(n(e.split(".")[o]))}catch(e){throw new r("Invalid token specified: "+e.message)}},e.exports.InvalidTokenError=r},"./src/index.js":function(e,t,o){"use strict";o.r(t);var n=o("../node_modules/jwt-decode/lib/index.js"),r=o.n(n);!function(){function e(e){var t="",o=document.cookie.split("; ").filter((function(t){return 0===t.indexOf(e)}))[0];return o&&(t=o.substring((e+"=").length)),t}function t(e,t,o){var n=[];n.push(e+"="+t),n.push("path=/"),n.push("expires="+o),n.push("domain=telegraph.co.uk"),n.push("SameSite=None;Secure"),document.cookie=n.join(";")}function o(o,n){var r=e("tmg_p13n"),i=JSON.parse(r.replace(/(\w+)\s*:/g,'"$1":')),c=i.pId,a=o&&o.profile;const s="subscribed"===a.readerType||"subscriber"===a.readerType,d=n.allowWinback;if(a){i.readerType=a.readerType,i.subscriber=""+s,i.allowWinback=d?""+d:"false",function(e,t,o){e&&e.subscriber!==t&&function(e){var t="https://api.telegraph.co.uk/commerce/accounts/"+e+"/status";window.fetch&&window.fetch(t,{mode:"cors",method:"DELETE",cache:"no-cache",headers:{ddgFlow:"transformation_refresh",ddgAction:"invalidate_cache"}}).catch(console.error)}(o)}(n,s,c),s?i.subscriptionType=n.subscriptionType:i.subscriptionType&&delete i.subscriptionType;var u=JSON.stringify(i).replace(/"(\w+)"\s*:/g,"$1:"),l=new Date;l.setTime(l.getTime()+94608e7),t("tmg_p13n",u,l.toGMTString()),window.fetch?window.fetch("https://api.telegraph.co.uk/userstore/cookies",{credentials:"include",mode:"cors",method:"POST",cache:"no-cache"}).then((function(){f&&f()}),(function(){f&&f()})):f&&f()}else console.error("no user data");var f}function n(e,t){var o=t||864e5,n=window&&window.localStorage&&window.localStorage.getItem(e);if(n){var r=new Date(n);if((new Date).getTime()-r.getTime()<o)return!1}return window&&window.localStorage&&window.localStorage.setItem(e,(new Date).toUTCString()),!0}!function(){var i=e("tmg_refresh");if(i){var c=e("__utp");if(c&&n("_utprefreshdate",864e5)||!c&&n("no_utprefreshdate",6e5)){var a={grant_type:"refresh_token",client_id:"tcuk",remember_me:!0,refresh_token:i};window.fetch&&window.fetch("https://api.telegraph.co.uk/identity/tokens",{mode:"cors",method:"POST",cache:"no-cache",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",ddgFlow:"transformation_refresh",ddgAction:"autologin"},body:JSON.stringify(a)}).then((function(n){201===n.status?n.json().then((function(n){var i,c=(i=n.id_token,r()(i));if(function(t){var n=e("tmg_p13n");if(n){var r=JSON.parse(n.replace(/(\w+)\s*:/g,'"$1":')).pId;!function(e,t,o){var n="https://api.telegraph.co.uk/commerce/accounts/"+t+"/status";window.fetch&&window.fetch(n,{mode:"cors",method:"GET",cache:"no-cache",headers:{ddgFlow:"transformation_refresh",ddgAction:"refresh_p13n"}}).then((function(e){return e.json()})).then((function(t){o&&o(e,t)})).catch(console.error)}(t,r,o)}}(c),n.piano_id_access_token){var a=new Date(1e3*n.piano_id_access_token_expires_in);t("__utp",n.piano_id_access_token,a.toUTCString()),window&&window.localStorage&&window.localStorage.setItem("_utprefreshdate",(new Date).toUTCString())}e("tmg_createddate")||((a=new Date).setFullYear(a.getFullYear()+3),t("tmg_createddate",c.profile.creationDateTimeInMillis,a.toUTCString()))})):console.warn(n)})).catch((function(e){console.log(e)}))}}else console.log("No tmg_refresh")}()}()}})}));